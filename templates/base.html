<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    {% block title %}
    Abishek Kumar - Portfolio
    {% endblock %}
  </title>
  <!--<script src="https://cdn.tailwindcss.com"></script> -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}" />
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/A-icon.jpg') }}" />

  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-52GJ4P6JH7"></script>
  <script>
    window.dataLayer = window.dataLayer || []
    function gtag() {
      dataLayer.push(arguments)
    }
    gtag('js', new Date())
    gtag('config', 'G-52GJ4P6JH7')
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

  <style>
    @media (hover: none) and (pointer: coarse) {
      * {
        cursor: auto !important;
      }

      #cursor-main,
      #cursor-dot {
        display: none !important;
      }
    }

    /* Global cursor hide (desktop only) */
    * {
      cursor: none !important;
    }

    /* Particle Canvas */
    #particle-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
      background: #E6E1EB;
      /* Light mode background - Pale Lilac */
    }

    /* Dark mode particle canvas background */
    .dark #particle-canvas {
      background: #110E15;
      /* Night */
    }

    /* Main cursor */
    #cursor-main {
      width: 18px;
      height: 18px;
      border: 2px solid #D6B6C6;
      border-radius: 50%;
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 99999;
      transform: translate(-50%, -50%);
      transition: transform 0.1s ease-out;
    }

    /* Small dot that follows faster */
    #cursor-dot {
      width: 6px;
      height: 6px;
      background: #D6B6C6;
      border-radius: 50%;
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 100000;
      transform: translate(-50%, -50%);
      transition: transform 0.05s ease-out;
    }

    /* When cursor hovers elements */
    .cursor-hover {
      transform: translate(-50%, -50%) scale(1.5);
      background: rgba(214, 182, 198, 0.2);
    }

    /* Glassmorphism */
    .glass-effect {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      outline: none !important;
      /* Prevent any outline */
    }

    .dark .glass-effect {
      background: rgba(31, 41, 55, 0.6);
      border: 1px solid rgba(75, 85, 99, 0.3);
      outline: none !important;
      /* Prevent any outline */
    }

    /* Prevent outline when glass-effect is active or focused */
    .glass-effect:focus,
    .glass-effect:focus-within,
    .glass-effect:active {
      outline: none !important;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    /* Scroll Reveal */
    .scroll-reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .scroll-reveal.active {
      opacity: 1;
      transform: translateY(0);
    }

    /* Click Ripple Effect with Color */
    .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple-animation 0.8s ease-out;
      pointer-events: none;
    }

    @keyframes ripple-animation {
      0% {
        transform: scale(0);
        opacity: 0.8;
      }

      100% {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Button Glow */
    .btn-glow {
      position: relative;
      overflow: hidden;
    }

    .btn-glow::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-glow:hover::before {
      width: 300px;
      height: 300px;
    }

    /* Card Hover Effects */
    .card-hover {
      transition: all 0.3s ease;
      position: relative;
    }

    .card-hover::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 2px;
      background: linear-gradient(135deg, #D6B6C6, #C9C2CC);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .card-hover:hover::before {
      opacity: 0.5;
    }

    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .dark .card-hover:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    #navigation-bar a {
      position: relative;
      display: inline-block;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #navigation-bar a:hover {
      transform: scale(1.02);
    }

    #navigation-bar a.nav-link-active:hover {
      transform: translateY(0);
      background-color: rgba(92, 14, 0, 0.727);
    }

    body {
      position: relative;
      overflow-x: hidden;
    }

    .magnetic {
      transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* Page Transition Styles */
    main {
      opacity: 0;
      transform: translateY(0);
    }

    main.page-loaded {
      opacity: 1;
    }

    /* MOBILE MENU FIXES */
    /* Slide down animation for mobile menu */
    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        max-height: 500px;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 1;
        max-height: 500px;
        transform: translateY(0);
      }

      to {
        opacity: 0;
        max-height: 0;
        transform: translateY(-10px);
      }
    }

    /* Mobile menu transition */
    #mobile-menu {
      overflow: hidden;
      transition: all 0.3s ease-in-out;
    }

    #mobile-menu.show {
      animation: slideDown 0.3s ease-in-out forwards;
    }

    #mobile-menu.hide {
      animation: slideUp 0.3s ease-in-out forwards;
    }

    /* Ensure mobile menu is properly hidden */
    #mobile-menu.hidden {
      display: none !important;
      opacity: 0;
      max-height: 0;
    }

    /* Header container smooth transition */
    #header-container {
      transition: border-radius 0.3s ease-in-out;
      outline: none !important;
      /* Prevent focus outline */
    }

    /* Remove focus outline from all interactive elements in header */
    #header-container *:focus,
    #header-container *:focus-visible {
      outline: none !important;
      box-shadow: none !important;
    }

    /* Specifically target the mobile menu button */
    #mobile-menu-button {
      outline: none !important;
      border: none !important;
      background: transparent !important;
      box-shadow: none !important;
      /* Tailwind ring utilities override */
      --tw-ring-offset-shadow: 0 0 #0000 !important;
      --tw-ring-shadow: 0 0 #0000 !important;
    }

    #mobile-menu-button:focus,
    #mobile-menu-button:focus-visible,
    #mobile-menu-button:active,
    #mobile-menu-button:hover,
    #mobile-menu-button.active {
      outline: none !important;
      box-shadow: none !important;
      border: none !important;
      background: transparent !important;
      /* Tailwind ring utilities override */
      --tw-ring-offset-shadow: 0 0 #0000 !important;
      --tw-ring-shadow: 0 0 #0000 !important;
    }

    /* Remove any webkit tap highlight */
    #mobile-menu-button,
    #header-container button {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    /* Ensure the icon inside button also has no outline */
    #mobile-menu-button i,
    #mobile-menu-button * {
      outline: none !important;
      border: none !important;
      box-shadow: none !important;
    }

    /* Mobile menu button active state */
    #mobile-menu-button.active i {
      transform: rotate(90deg);
      transition: transform 0.3s ease;
    }

    /* Ensure mobile menu items are clickable */
    #mobile-menu a {
      position: relative;
      z-index: 20;
      pointer-events: auto;
    }
  </style>
</head>

<body
  class="text-gray-900 dark:text-gray-100 transition-colors duration-300 {% if active_page == 'about' %}about-page{% endif %}"
  style="background: transparent;">
  <!-- Custom Cursor (No Trail) -->
  <div id="cursor-main"></div>

  <!-- Particle Background -->
  <canvas id="particle-canvas"></canvas>

  <!-- Navigation Header - Floating Style -->
  <header class="sticky top-2 z-50 px-4">
    <div id="header-container"
      class="max-w-4xl mx-auto glass-effect shadow-lg rounded-3xl transition-all duration-500 overflow-hidden">
      <!-- Main Navbar -->
      <div class="py-2 px-6 flex justify-between items-center relative z-10">
        <div class="flex items-center">
          <a href="{{ url_for('about') }}"
            class="site-title text-lg font-bold hover:text-dark-purple dark:hover:text-misty-plum transition-colors">Abishek
            Kumar</a>
        </div>

        <!-- Desktop Navigation -->
        <nav id="navigation-bar" class="hidden md:flex space-x-4">
          <a href="{{ url_for('about') }}" data-page="about"
            class="nav-link px-2 py-1 rounded-full text-xs font-medium transition-colors duration-200">
            <i class="fas fa-user mr-2"></i>About
          </a>
          <a href="{{ url_for('projects') }}" data-page="projects"
            class="nav-link px-2 py-1 rounded-full text-xs font-medium transition-colors duration-200">
            <i class="fas fa-code mr-2"></i>Projects
          </a>
          <a href="{{ url_for('academics') }}" data-page="academics"
            class="nav-link px-2 py-1 rounded-full text-xs font-medium transition-colors duration-200">
            <i class="fas fa-graduation-cap mr-2"></i>Academics
          </a>
          <a href="{{ url_for('research') }}" data-page="research"
            class="nav-link px-2 py-1 rounded-full text-xs font-medium transition-colors duration-200">
            <i class="fas fa-flask mr-2"></i>Research
          </a>
          <a href="{{ url_for('contact') }}" data-page="contact"
            class="nav-link px-2 py-1 rounded-full text-xs font-medium transition-colors duration-200">
            <i class="fas fa-envelope mr-2"></i>Contact
          </a>
        </nav>

        <!-- Social Links & Theme Toggle (Desktop Only) -->
        <div class="hidden md:flex items-center space-x-2">
          <a href="https://github.com/Abishek-Kumar-GHub" target="_blank"
            class="text-gray-600 dark:text-gray-300 hover:text-dark-purple dark:hover:text-misty-plum transition-colors duration-200"><i
              class="fab fa-github text-sm"></i></a>
          <a href="https://www.linkedin.com/in/abishek--kumar/" target="_blank"
            class="text-gray-600 dark:text-gray-300 hover:text-dark-purple dark:hover:text-misty-plum transition-colors duration-200"><i
              class="fab fa-linkedin text-sm"></i></a>
          <a href="https://medium.com/@abishektechy" target="_blank"
            class="text-gray-600 dark:text-gray-300 hover:text-dark-purple dark:hover:text-misty-plum transition-colors duration-200"><i
              class="fab fa-medium text-sm"></i></a>
          <button id="theme-toggle-desktop"
            class="theme-toggle-btn text-gray-600 dark:text-gray-300 hover:text-dark-purple dark:hover:text-misty-plum transition-colors duration-200 focus:outline-none ml-2"><i
              class="fas fa-moon dark:fa-sun text-sm"></i></button>
        </div>

        <!-- Mobile Controls -->
        <div class="md:hidden flex items-center space-x-3">
          <button id="theme-toggle-mobile"
            class="theme-toggle-btn text-gray-600 dark:text-gray-300 hover:text-dark-purple dark:hover:text-misty-plum transition-colors duration-200 focus:outline-none"><i
              class="fas fa-moon dark:fa-sun text-sm"></i></button>
          <button id="mobile-menu-button"
            class="p-2 text-gray-600 dark:text-gray-300 transition-colors focus:outline-none">
            <i class="fas fa-bars text-xl"></i>
          </button>
        </div>
      </div>

      <!-- Mobile Navigation Menu - Unified Style -->
      <div id="mobile-menu" class="hidden md:hidden pb-6 px-6">
        <div class="flex flex-col space-y-2 mt-2">
          <a href="{{ url_for('about') }}" data-page="about"
            class="mobile-nav-link flex items-center px-4 py-3 rounded-2xl text-sm font-semibold transition-all duration-300">
            <i class="fas fa-user w-6 mr-3 text-lg opacity-70"></i>About Me
          </a>
          <a href="{{ url_for('projects') }}" data-page="projects"
            class="mobile-nav-link flex items-center px-4 py-3 rounded-2xl text-sm font-semibold transition-all duration-300">
            <i class="fas fa-code w-6 mr-3 text-lg opacity-70"></i>Projects
          </a>
          <a href="{{ url_for('academics') }}" data-page="academics"
            class="mobile-nav-link flex items-center px-4 py-3 rounded-2xl text-sm font-semibold transition-all duration-300">
            <i class="fas fa-graduation-cap w-6 mr-3 text-lg opacity-70"></i>Academics
          </a>
          <a href="{{ url_for('research') }}" data-page="research"
            class="mobile-nav-link flex items-center px-4 py-3 rounded-2xl text-sm font-semibold transition-all duration-300">
            <i class="fas fa-flask w-6 mr-3 text-lg opacity-70"></i>Research
          </a>
          <a href="{{ url_for('contact') }}" data-page="contact"
            class="mobile-nav-link flex items-center px-4 py-3 rounded-2xl text-sm font-semibold transition-all duration-300">
            <i class="fas fa-envelope w-6 mr-3 text-lg opacity-70"></i>Contact
          </a>
        </div>

        <!-- Mobile Menu Socials -->
        <div
          class="flex items-center justify-center space-x-8 mt-6 pt-6 border-t border-gray-200/50 dark:border-white/10">
          <a href="https://github.com/Abishek-Kumar-GHub" target="_blank"
            class="text-gray-500 dark:text-gray-400 hover:text-dark-purple dark:hover:text-misty-plum"><i
              class="fab fa-github text-xl"></i></a>
          <a href="https://www.linkedin.com/in/abishek--kumar/" target="_blank"
            class="text-gray-500 dark:text-gray-400 hover:text-dark-purple dark:hover:text-misty-plum"><i
              class="fab fa-linkedin text-xl"></i></a>
          <a href="https://medium.com/@abishektechy" target="_blank"
            class="text-gray-500 dark:text-gray-400 hover:text-dark-purple dark:hover:text-misty-plum"><i
              class="fab fa-medium text-xl"></i></a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6 pb-8 relative z-10">
    {% block content %}
    {% endblock %}
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 dark:bg-gray-950 text-white py-12 mt-16 transition-colors duration-300 relative z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <h3 class="text-lg font-semibold mb-4">Abishek Kumar</h3>
          <p class="text-gray-400">Computer Applications Graduate specializing in Cyber Security</p>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
          <ul class="space-y-2 text-gray-400">
            <li>
              <a href="{{ url_for('about') }}" class="hover:text-white transition-colors">About Me</a>
            </li>
            <li>
              <a href="{{ url_for('projects') }}" class="hover:text-white transition-colors">Projects</a>
            </li>
            <li>
              <a href="{{ url_for('academics') }}" class="hover:text-white transition-colors">Academics</a>
            </li>
            <li>
              <a href="{{ url_for('research') }}" class="hover:text-white transition-colors">Research</a>
            </li>
            <li>
              <a href="{{ url_for('contact') }}" class="hover:text-white transition-colors">Contact</a>
            </li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Connect With Me</h3>
          <div class="flex space-x-4">
            <a href="https://github.com/Abishek-Kumar-GHub" target="_blank"
              class="text-gray-400 hover:text-white transition-colors"><i class="fab fa-github text-xl"></i></a>
            <a href="https://www.linkedin.com/in/abishek--kumar/" target="_blank"
              class="text-gray-400 hover:text-white transition-colors"><i class="fab fa-linkedin text-xl"></i></a>
            <a href="https://medium.com/@abishektechy" target="_blank"
              class="text-gray-400 hover:text-white transition-colors"><i class="fab fa-medium text-xl"></i></a>
            <a href="mailto:abishek.techy@gmail.com" class="text-gray-400 hover:text-white transition-colors"><i
                class="fas fa-envelope text-xl"></i></a>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
        <p>&copy; 2025 Abishek Kumar. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // GLOBAL Navigation Active State Management
    // This function is exposed globally so page-transitions.js can call it
    // Accepts optional targetPath parameter for immediate updates before page load
    window.updateNavigationState = function (targetPath) {
      const currentPath = targetPath || window.location.pathname;
      console.log('Updating navigation state for path:', currentPath);

      // Desktop navigation
      const desktopLinks = document.querySelectorAll('#navigation-bar .nav-link');
      desktopLinks.forEach(link => {
        const linkPage = link.getAttribute('data-page');
        const linkHref = link.getAttribute('href');

        // Remove ALL possible classes first
        link.classList.remove('nav-link-active', 'nav-link-inactive');
        link.classList.remove('bg-rose-dust', 'dark:bg-chocolate-cosmos', 'text-dark-purple', 'dark:text-misty-plum');
        link.classList.remove('text-gray-600', 'dark:text-gray-300', 'hover:text-dark-purple', 'dark:hover:text-misty-plum');

        // Check if this link matches current page (exact match only)
        const isActive = currentPath.endsWith(`/${linkPage}`) ||
          (currentPath === '/' && linkPage === 'about') ||
          (currentPath === linkHref);

        if (isActive) {
          link.classList.add('nav-link-active');
          link.classList.add('bg-rose-dust', 'dark:bg-chocolate-cosmos', 'text-dark-purple', 'dark:text-misty-plum');
          console.log('Active link:', linkPage);
        } else {
          link.classList.add('nav-link-inactive');
          link.classList.add('text-gray-600', 'dark:text-gray-300', 'hover:text-dark-purple', 'dark:hover:text-misty-plum');
        }
      });

      // Mobile navigation
      const mobileLinks = document.querySelectorAll('#mobile-menu .mobile-nav-link');
      mobileLinks.forEach(link => {
        const linkPage = link.getAttribute('data-page');
        const linkHref = link.getAttribute('href');

        // Remove ALL possible classes first
        link.classList.remove('bg-rose-dust/80', 'dark:bg-chocolate-cosmos/80', 'text-dark-purple', 'dark:text-misty-plum', 'shadow-sm');
        link.classList.remove('text-gray-600', 'dark:text-gray-300', 'hover:bg-white/40', 'dark:hover:bg-white/10');

        // Check if this link matches current page (exact match only)
        const isActive = currentPath.endsWith(`/${linkPage}`) ||
          (currentPath === '/' && linkPage === 'about') ||
          (currentPath === linkHref);

        if (isActive) {
          link.classList.add('bg-rose-dust/80', 'dark:bg-chocolate-cosmos/80', 'text-dark-purple', 'dark:text-misty-plum', 'shadow-sm');
        } else {
          link.classList.add('text-gray-600', 'dark:text-gray-300', 'hover:bg-white/40', 'dark:hover:bg-white/10');
        }
      });
    };

    document.addEventListener('DOMContentLoaded', () => {
      // Update navigation state on page load
      window.updateNavigationState();

      // Accurate Custom Cursor (No Trail, Minimal Smoothing)
      const cursorMain = document.getElementById('cursor-main')

      // Direct cursor positioning with minimal lag
      document.addEventListener('mousemove', (e) => {
        cursorMain.style.left = e.clientX + 'px'
        cursorMain.style.top = e.clientY + 'px'
      })

      // Magnetic effect ONLY for elements with .magnetic class
      const magneticElements = document.querySelectorAll('.magnetic, button')

      magneticElements.forEach((el) => {
        el.addEventListener('mouseenter', () => {
          cursorMain.classList.add('cursor-hover')
        })

        el.addEventListener('mouseleave', () => {
          cursorMain.classList.remove('cursor-hover')
          el.style.transform = ''
        })

        el.addEventListener('mousemove', (e) => {
          const rect = el.getBoundingClientRect()
          const x = e.clientX - rect.left - rect.width / 2
          const y = e.clientY - rect.top - rect.height / 2

          el.style.transform = `translate(${x * 0.1}px, ${y * 0.1}px)`
        })
      })

      // Cursor hover effect for ALL other buttons and links
      const allInteractive = document.querySelectorAll('a, input, select, textarea')

      allInteractive.forEach((el) => {
        if (el.classList.contains('magnetic')) return

        el.style.pointerEvents = 'auto'

        el.addEventListener('mouseenter', () => {
          cursorMain.classList.add('cursor-hover')
        })

        el.addEventListener('mouseleave', () => {
          cursorMain.classList.remove('cursor-hover')
        })
      })

      // Elegant Floating Particles
      const canvas = document.getElementById('particle-canvas')
      const ctx = canvas.getContext('2d')
      canvas.width = window.innerWidth
      canvas.height = window.innerHeight

      const particles = []
      const particleCount = 70 // Slightly more particles
      let mouseX = window.innerWidth / 2
      let mouseY = window.innerHeight / 2

      document.addEventListener('mousemove', (e) => {
        mouseX = e.clientX
        mouseY = e.clientY
      })

      class Particle {
        constructor() {
          this.x = Math.random() * canvas.width
          this.y = Math.random() * canvas.height
          this.vx = (Math.random() - 0.5) * 0.5 // Gentle velocity
          this.vy = (Math.random() - 0.5) * 0.5
          this.size = Math.random() * 2 + 1 // Varied size 1-3px
        }

        update() {
          this.x += this.vx
          this.y += this.vy

          // Gentle bounce off walls
          if (this.x < 0 || this.x > canvas.width) this.vx *= -1
          if (this.y < 0 || this.y > canvas.height) this.vy *= -1

          // Gentle mouse repel
          const dx = mouseX - this.x
          const dy = mouseY - this.y
          const distance = Math.sqrt(dx * dx + dy * dy)
          if (distance < 100) {
            const angle = Math.atan2(dy, dx)
            const force = (100 - distance) / 100
            this.vx -= Math.cos(angle) * force * 0.02
            this.vy -= Math.sin(angle) * force * 0.02
          }
        }

        draw() {
          const isDark = document.documentElement.classList.contains('dark')
          const color = isDark ? '214, 182, 198' : '65, 29, 43' // Misty Plum : Dark Purple

          ctx.beginPath()
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2)
          ctx.fillStyle = `rgba(${color}, 0.6)`
          ctx.fill()
        }
      }

      for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle())
      }

      function animateParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)

        const isDark = document.documentElement.classList.contains('dark')
        const color = isDark ? '214, 182, 198' : '65, 29, 43'

        particles.forEach((particle, index) => {
          particle.update()
          particle.draw()

          // Connect nearby particles
          for (let j = index + 1; j < particles.length; j++) {
            const dx = particle.x - particles[j].x
            const dy = particle.y - particles[j].y
            const distance = Math.sqrt(dx * dx + dy * dy)

            if (distance < 120) {
              ctx.beginPath()
              ctx.strokeStyle = `rgba(${color}, ${0.15 * (1 - distance / 120)})`
              ctx.lineWidth = 1
              ctx.moveTo(particle.x, particle.y)
              ctx.lineTo(particles[j].x, particles[j].y)
              ctx.stroke()
            }
          }
        })
        requestAnimationFrame(animateParticles)
      }
      animateParticles()

      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth
        canvas.height = window.innerHeight
      })

      // Subtle Ripple Effect on Click
      document.addEventListener('click', (e) => {
        const isDark = document.documentElement.classList.contains('dark')
        const color = isDark ? '#D6B6C6' : '#411D2B'

        const ripple = document.createElement('div')
        ripple.className = 'ripple'
        ripple.style.left = e.clientX + 'px'
        ripple.style.top = e.clientY + 'px'
        ripple.style.width = ripple.style.height = '20px'
        ripple.style.background = `radial-gradient(circle, ${color}40 0%, transparent 70%)`
        ripple.style.border = `1px solid ${color}`
        document.body.appendChild(ripple)

        setTimeout(() => ripple.remove(), 800)
      })

      // Theme Toggle
      const htmlEl = document.documentElement
      const themeToggleDesktop = document.getElementById('theme-toggle-desktop')
      const themeToggleMobile = document.getElementById('theme-toggle-mobile')

      const savedTheme = localStorage.getItem('theme') || 'light'

      if (savedTheme === 'dark') {
        htmlEl.classList.add('dark')
      } else {
        htmlEl.classList.remove('dark')
      }

      function updateThemeIcons() {
        const isDark = htmlEl.classList.contains('dark')
        const allIcons = [themeToggleDesktop?.querySelector('i'), themeToggleMobile?.querySelector('i')]

        allIcons.forEach((icon) => {
          if (icon) {
            if (isDark) {
              icon.classList.remove('fa-moon')
              icon.classList.add('fa-sun')
            } else {
              icon.classList.remove('fa-sun')
              icon.classList.add('fa-moon')
            }
          }
        })
      }

      function toggleTheme() {
        htmlEl.classList.toggle('dark')
        const isDark = htmlEl.classList.contains('dark')
        localStorage.setItem('theme', isDark ? 'dark' : 'light')
        updateThemeIcons()
      }

      updateThemeIcons()

      if (themeToggleDesktop) {
        themeToggleDesktop.addEventListener('click', toggleTheme)
      }

      if (themeToggleMobile) {
        themeToggleMobile.addEventListener('click', toggleTheme)
      }

      // IMPROVED Mobile Menu Toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button')
      const mobileMenu = document.getElementById('mobile-menu')
      const headerContainer = document.getElementById('header-container')

      if (mobileMenuButton && mobileMenu && headerContainer) {
        let isMenuOpen = false

        mobileMenuButton.addEventListener('click', (e) => {
          e.preventDefault()
          e.stopPropagation()

          // Remove focus from button to prevent outline
          e.currentTarget.blur()

          isMenuOpen = !isMenuOpen

          if (isMenuOpen) {
            // Open menu
            mobileMenu.classList.remove('hidden', 'hide')
            mobileMenu.classList.add('show')
            mobileMenuButton.classList.add('active')
          } else {
            // Close menu
            mobileMenu.classList.remove('show')
            mobileMenu.classList.add('hide')
            mobileMenuButton.classList.remove('active')

            // Wait for animation to finish before hiding
            setTimeout(() => {
              if (!isMenuOpen) {
                mobileMenu.classList.add('hidden')
                mobileMenu.classList.remove('hide')
              }
            }, 300)
          }

          // Toggle icon
          const icon = mobileMenuButton.querySelector('i')
          if (icon) {
            if (isMenuOpen) {
              icon.classList.remove('fa-bars')
              icon.classList.add('fa-times')
            } else {
              icon.classList.remove('fa-times')
              icon.classList.add('fa-bars')
            }
          }
        })

        // Close menu when clicking on a link
        const mobileMenuLinks = mobileMenu.querySelectorAll('a')
        mobileMenuLinks.forEach(link => {
          link.addEventListener('click', () => {
            isMenuOpen = false
            mobileMenu.classList.remove('show')
            mobileMenu.classList.add('hide')
            mobileMenuButton.classList.remove('active')

            const icon = mobileMenuButton.querySelector('i')
            if (icon) {
              icon.classList.remove('fa-times')
              icon.classList.add('fa-bars')
            }

            setTimeout(() => {
              mobileMenu.classList.add('hidden')
              mobileMenu.classList.remove('hide')
            }, 300)
          })
        })

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
          if (isMenuOpen &&
            !mobileMenu.contains(e.target) &&
            !mobileMenuButton.contains(e.target)) {
            isMenuOpen = false
            mobileMenu.classList.remove('show')
            mobileMenu.classList.add('hide')
            mobileMenuButton.classList.remove('active')

            const icon = mobileMenuButton.querySelector('i')
            if (icon) {
              icon.classList.remove('fa-times')
              icon.classList.add('fa-bars')
            }

            setTimeout(() => {
              mobileMenu.classList.add('hidden')
              mobileMenu.classList.remove('hide')
            }, 300)
          }
        })
      }

      // Smooth Scrolling
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault()
          const target = document.querySelector(this.getAttribute('href'))
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth'
            })
          }
        })
      })
    })

    // Update navigation on popstate (browser back/forward)
    window.addEventListener('popstate', window.updateNavigationState);

    // Scroll Reveal
    document.addEventListener('DOMContentLoaded', () => {
      const revealElements = document.querySelectorAll('.scroll-reveal')

      const revealOnScroll = () => {
        const windowHeight = window.innerHeight
        revealElements.forEach((el) => {
          const elementTop = el.getBoundingClientRect().top
          if (elementTop < windowHeight - 100) {
            el.classList.add('active')
          }
        })
      }

      window.addEventListener('scroll', revealOnScroll)

      // Immediate reveal on page load - critical for direct landing
      setTimeout(() => {
        revealOnScroll()
      }, 100)
    })

    // Ensure custom cursor doesn't block clicks
    document.addEventListener('DOMContentLoaded', function () {
      // Get all custom cursor elements
      const cursors = document.querySelectorAll('.custom-cursor, .cursor, [class*="cursor"]')

      // Make cursors non-blocking
      cursors.forEach((cursor) => {
        cursor.style.pointerEvents = 'none'
      })

      // Ensure all interactive elements are clickable
      const interactiveElements = document.querySelectorAll('a, button, input, select, textarea')

      interactiveElements.forEach((el) => {
        el.style.position = 'relative'
        el.style.zIndex = '10'
        el.style.pointerEvents = 'auto'
      })

      // Debug: Log if buttons are clickable
      const buttons = document.querySelectorAll('.project-card button, .project-card a')
      console.log(`Found ${buttons.length} interactive elements in project cards`)
    })

    if (matchMedia('(hover: none) and (pointer: coarse)').matches) {
      document.getElementById('cursor-main').style.display = 'none'
      const cursorDot = document.getElementById('cursor-dot')
      if (cursorDot) cursorDot.style.display = 'none'
    } else {
      const cursorMain = document.getElementById('cursor-main')
      const cursorDot = document.getElementById('cursor-dot')

      document.addEventListener('mousemove', (e) => {
        cursorMain.style.left = e.clientX + 'px'
        cursorMain.style.top = e.clientY + 'px'

        if (cursorDot) {
          cursorDot.style.left = e.clientX + 'px'
          cursorDot.style.top = e.clientY + 'px'
        }
      })

      // Hover animation for links & buttons
      document.querySelectorAll('a, button, .clickable').forEach((element) => {
        element.addEventListener('mouseenter', () => cursorMain.classList.add('cursor-hover'))
        element.addEventListener('mouseleave', () => cursorMain.classList.remove('cursor-hover'))
      })
    }
  </script>

  <!-- Projects Page Functionality -->
  <script src="{{ url_for('static', filename='js/projects.js') }}"></script>

  <!-- Page Transitions Script -->
  <script src="{{ url_for('static', filename='js/page-transitions.js') }}"></script>

  {% block modal %}
  {% endblock %}
</body>

</html>